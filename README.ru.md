# Поиск дубликатов файлов и директорий (dup.py)

`dup.py` - это универсальный инструмент командной строки, который помогает вам находить и управлять дубликатами файлов и директорий. Он сканирует указанные директории, определяет дубликаты файлов и директорий на основе различных критериев сравнения и предлагает варианты удаления или замены этих дубликатов. В отличии от большинства подобных инструментов, `dup.py` умеет находить дубликаты максимально эффективно и не только файлы, но и директории.

## Установка

Для удобства использования это всего лишь один питон-файл, который можно самостоятельно скачать и свободно поместить куда угодно.
Скрипт, который автоматически скачивает файл `dup.py` из репозитория на GitHub, делает его исполняемым и помещает в директорию `bin` в домашней директории:

```bash
mkdir -p "${HOME}/bin" && curl -L "https://raw.githubusercontent.com/NikolayBorisov/dup.py/main/dup.py" -o "${HOME}/bin/dup.py" && chmod +x "${HOME}/bin/dup.py"
```

Вы можете просто скопировать и вставить эту команду в свою консоль и нажать Enter.

Обратите внимание, что это предполагает, что директория `${HOME}/bin` уже находится в переменной PATH. Если это не так, то вам потребуется добавить его в PATH, что можно сделать следующим образом:

```bash
echo 'export PATH="${HOME}/bin:${PATH}"' >> "${HOME}/.bashrc" && source "${HOME}/.bashrc"
```

Или для пользователей zsh:

```bash
echo 'export PATH="${HOME}/bin:${PATH}"' >> "${HOME}/.zshrc" && source "${HOME}/.zshrc"
```

Это нужно сделать только один раз. После этого вы сможете использовать `dup.py`.

## Использование

```plaintext
dup.py [directories [directories ...]] [options]
```

## Аргументы

##### Основные

- `directories`: Список директорий для сканирования на предмет дубликатов файлов и директорий. Если директории не указаны, используется текущий рабочий каталог.
- `-c`, `--check CHECK`: Указать набор параметров или пресетов для сравнения. Может быть комбинацией [epic,full,data,fast,tree,name,dirname,filename,date,size,bytes,firstbytes,lastbytes,count,dircount,filecount,hash]. Вы можете указать несколько значений, разделенных запятыми. Например, `--check size,name`
- `-i`, `--ignore IGNORE`: Указать набор параметров или пресетов для игнорирования при сравнении. Может быть комбинацией [epic,full,data,fast,tree,name,dirname,filename,date,size,bytes,firstbytes,lastbytes,count,dircount,filecount,hash]. Вы можете указать несколько значений, разделенных запятыми. Например, `--ignore date`

##### Фильтры

- `-f`, `--files-only`: Искать только дубликаты файлов и пропустить директории.
- `-d`, `--dirs-only`: Искать только дубликаты директорий.
- `--min-size MINSIZE`,
  `--max-size MAXSIZE`,
  `--min-dir-size MIN_DIR_SIZE`,
  `--max-dir-size MAX_DIR_SIZE`,
  `--min-file-size MIN_FILE_SIZE`,
  `--max-file-size MAX_FILE_SIZE`: Эти аргументы задают минимальные и максимальные размеры для файлов и директорий. Размеры должны указываться в виде строки с числом и единицей измерения. Например, `--min-size 10KB` или `--max-dir-size 2GB`. Будьте внимательны при использовании данного фильтра, т.к. файлы и директории не прошедшие фильтр не учитываются при сравнении, это может привезти к нахождению ложных дубликатов, особенно в случае стандартного сравнения с параметром `--process-empty`, где не учитываются имена директорий. Все пустые директории будут признаны дубликатами, хотя внутри могут находится файлы и директории не прошедшие фильтр.
- `--process-empty`: Обрабатывать пустые директории и файлы. По сути, аналогично `--min-size 0`.
- `--exclude PATTERNS`,
  `--exclude-dirs DIR_PATTERNS`,
  `--exclude-files FILE_PATTERNS`: Исключать директории и файлы, которые соответствуют заданным шаблонам. Можно использовать шаблоны, например, `*.bak` или `/dir/**`

##### Действия

- `-S`, `--symlink`: Заменить дублирующие файлы и директории символическими ссылками.
- `-H`, `--hardlink`: Заменить дублирующие файлы и директории жесткими ссылками.
- `-D`, `--delete`: Удалить дубликаты файлов и директорий.
- `--stat`: Отображать краткую статистику и не выполнять никаких дальнейших действий.

##### Дополнительно

- `--relative-paths`: Отображать относительные пути директорий и файлов в выводе. Удобно, для визуального контроля, когда абсолютные пути слишком длинные.

##### Расширенные параметры

Не рекомендуется применять данные параметры, если вы точно не знаете, что делаете.

- `--follow-links`: Разрешает следование за символическими ссылками при обходе директории. Может привести к бесконечному выполнению и ошибкам.
- `--no-combine`: Обрабатывать все дубликаты файлов и директорий без компактации.
- `--no-combine-dirs`: Обрабатывать все дублирующие директории без компактации.
- `--no-combine-files`: Обрабатывать все файлы без их скрытия в дублирующих директориях.
- `--bench`: Выполнить бенчмарк для измерения времени выполнения.
- `--chunk CHUNK`: Размер блока для проверки первых байтов файла `firstbytes` и последних `lastbytes` в байтах (по умолчанию: 65536 байт).
- `--no-cache`: По умолчанию все тяжелые вычисления `bytes` и `hash` кешируются, чтобы их можно было мгновенно извлечь при последующих запусках скрипта. Опция `--no-cache` отключает это поведение и указывает скрипту не использовать кэш.
- `--reset-cache`: Эта опция очищает существующий кэш и создает новый. Это полезно, если вы хотите заставить скрипт снова выполнить тяжелые вычисления `bytes` и `hash`, например, после изменения данных и желания, чтобы кэш отражал текущее состояние данных.

Всегда помните, что использование `--no-cache` или `--reset-cache` может значительно увеличить время выполнения скрипта, поскольку он должен вычислять `bytes` и `hash` с нуля. Однако эти опции могут быть полезны в ситуациях, когда вы хотите убедиться, что скрипт работает с самыми актуальными данными.

## Пресеты для сравнения:

1. `epic`: Исчерпывающая проверка на наличие дубликатов. Производит сравнение по `date`, `name`, и `data` файла (которые включают `size`, `bytes`, `count`, и `hash`).
2. `full`: Полная проверка на наличие дубликатов. Сравнивает `name` и `data` (включающие `size`, `bytes`, `count`, и `hash`).
3. `data`: Стандартная **по умолчанию** проверка на дубликаты. Сравнивает `size`, `bytes`, `count`, и `hash` файлов и директорий.
4. `fast`: Быстрая проверка на дубликаты. Сравнивает `size` и `tree` (включающую `name` и `count`) файлов.
5. `tree`: Проверка на дубликаты на основе иерархии файлов. Сравнивает `name` и `count`.

Когда вы используете эти пресеты, обратите внимание, что некоторые параметры, такие как `name`, `data`, `bytes`, и `count`, имеют дополнительные прикрепленные к ним параметры (например, `name` включает `dirname` и `filename`, `bytes` включает `firstbytes` и `lastbytes`, а `count` включает `dircount` и `filecount`).

Вы также можете использовать аргумент `--ignore` для выборочного исключения этих параметров из проверки.

##### Вот несколько примеров совместного использования `-c` (`--check`) и `-i` (`--ignore`):

1. **Исключение некоторых свойств из пресета**: Предположим, вы хотите использовать пресет `data`, но игнорировать свойство `size`. Вы можете использовать флаг `--ignore` для этого:

   ```bash
   dup.py /path/to/directory -c data -i hash
   ```

   Это будет проверять дубликаты на основе `bytes`, `count`, и `size`, но не `hash`.
2. **Добавление дополнительных свойств к пресету**: Предположим, вы хотите использовать пресет `fast`, но также включить `hash` в сравнение. Вы можете использовать флаг `--check` для добавления `hash`:

   ```bash
   dup.py /path/to/directory -c fast,hash
   ```

   Это будет проверять дубликаты на основе `size`, `tree`, и `hash`.
3. **Использование нескольких пресетов и исключение некоторых свойств**: Если вы хотите объединить несколько пресетов, но игнорировать некоторые свойства, вы можете сделать это следующим образом:

   ```bash
   dup.py /path/to/directory -c full,fast -i size,count
   ```

   Это будет использовать как пресет `full`, так и `fast`, но игнорировать свойства `size` и `count`. Будет проводиться проверка дубликатов на основе `name`, `bytes`, и `hash` (`full` минус `size` и `count`) и `tree` (`fast` минус `count`).

Помните, что флаги `-c` и `-i` могут принимать список свойств или пресетов, разделенных запятыми, для включения или исключения соответственно.

## Заметки

Используйте этот инструмент с осторожностью, особенно при использовании флага `--delete`, `--symlink` или `--hardlink`, так как он навсегда удаляет файлы. Всегда просматривайте список дублирующихся файлов перед проведением любых действий по удалению. Убедитесь, что у вас есть резервная копия всех важных данных. Используйте опции `-f` или `-d` для ограничения поиска файлами или директориями соответственно. Экспериментируйте с различными комбинациями флагов, чтобы подстроить под ваш конкретный случай использования.
